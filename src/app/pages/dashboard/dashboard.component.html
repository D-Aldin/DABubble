<app-header></app-header>

<section>
  <div class="dashboard-wrapper">
    <!-- Sidenav -->
    @if (showSidenav) {
    <app-sidenav class="sidenav" (openAddChannelDialog)="openAddChannelDialog()"
      (channelSelected)="selectChannel($event)">
    </app-sidenav>
    }

    <!-- Main content container -->
    <div class="main-container" [class.expanded]="!showSidenav">

      <!-- Toggle Button  -->
      <button class="sidenav-toggle-btn" (click)="toggleSidenav()" (mouseenter)="hovered = true"
        (mouseleave)="hovered = false">
        <div class="btn-content" [class.hover-blue]="hovered">
          @if (showSidenav) {
          <div class="icon-box">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 16 16"
              fill="currentColor">
              <path d="M6 4l4 4-4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </div>
          <span class="label">Workspace-Menü schließen</span>
          } @else {
          <div class="icon-box">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 16 16"
              fill="currentColor">
              <path d="M10 12L6 8l4-4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </div>
          <span class="label">Workspace-Menü öffnen</span>
          }
        </div>
      </button>

      <!-- Add-Channel-Dialog & Add-People-dialog-->
      @if (showAddChannelDialog) {
      <div class="overlay" (click)="closeAddChannelDialog()">
        <div class="dialog-container" (click)="$event.stopPropagation()">
          <app-add-channel (close)="closeAddChannelDialog()" (openAddPeopleDialog)="openAddPeopleDialog()"
            (complete)="handleChannelCreation($event)" (proceedToPeople)="handleProceedToPeople($event)">
          </app-add-channel>
        </div>
      </div>
      }
      @if (showPeopleDialog) {
      <div class="overlay" (click)="closePeopleDialog()">
        <div class="dialog-container" (click)="$event.stopPropagation()">
          <app-add-people [channelName]="createdChannelName" (cancel)="closePeopleDialog()"
            (confirm)="handlePeopleConfirmed($event)">
          </app-add-people>
        </div>
      </div>
      }
      <!--Dashboard Main Content -->
      <div class="main-content">

      <!-- Channel-Header in Dashboard -->
      @if (selectedChannel && currentUrl !== '/dashboard/direct-message') {
        <div class="channel-header">
          <!-- Left side: Channel avatar + name -->
          <div class="channel-info">
           <button class="channel-dropdown" (click)="toggleChannelOptionsPopup()">
            <span><b>#</b> {{ selectedChannel.title }}</span>
            <span class="arrow">▾</span>
          </button>

            <!-- Channel Popup -->
             @if (showChannelOptionsPopup) {
              <div class="channel-popup">
                <h3># {{ selectedChannel.title }}</h3>

                <!-- Channel Name Section -->
                <div class="popup-section boxed">
                  <div class="popup-section-header">
                    <span>Channel-Name</span>
                    <button (click)="editChannelName()">Bearbeiten</button>
                  </div>
                  <p><b>#</b> {{ selectedChannel.title }}</p>
                </div>

                <!-- Description Section -->
                <div class="popup-section boxed">
                  <div class="popup-section-header">
                    <span>Beschreibung</span>
                    <button (click)="editChannelDescription()">Bearbeiten</button>
                  </div>
                  <p>{{ selectedChannel.description }}</p>
                </div>

                <!-- Created By -->
                <div class="popup-section">
                  <span>Erstellt von</span>
                  <p class="creator-name" [ngClass]="{ 'online': creatorOnline }">
                    {{ creatorName }}
                  </p>
                </div>

                <div class="popup-actions">
                  <button class="leave-btn" (click)="toggleChannelOptionsPopup()">Channel verlassen</button>
                </div>

                <button class="popup-close" (click)="toggleChannelOptionsPopup()">×</button>
              </div>
            }

          </div>

          <!-- Right side: User avatars + count + add-users button -->
          <div class="channel-users">
            @if (selectedChannel.members.length > 0) {
              <div class="user-avatars">
                @for (user of selectedChannelPreviewUsers; track user.id) {
                  <img [src]="user.avatarPath" class="user-avatar" [alt]="user.name" />
                }
              </div>
              <span class="user-count">{{ selectedChannel.members.length }}</span>
            }

            <button class="add-user-btn"
              (click)="openAddPeopleDialog({ name: selectedChannel.title, description: selectedChannel.description })"
              title="Mitglieder hinzufügen">
              <img src="/assets/images/sidenav-img/person_add.svg" alt="Add User" />
            </button>
          </div>

          <!-- Channel Options Popup -->
         
        </div>
      }


        <router-outlet></router-outlet>

      </div>

    </div>




    <!--Dashboard Thread Content -->
    <app-thread *ngIf="selectedChannel">
      @for (item of chatMessages; track $index) {
      <app-chat-box [src]="item.src" [userName]="item.userName" [time]="item.time" [message]="item.message"
        [userMe]="item.userMe">></app-chat-box>
      }
    </app-thread>

  </div>
</section>